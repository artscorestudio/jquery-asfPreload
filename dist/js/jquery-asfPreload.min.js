/*!
 * Artscore Studio Preload jQuery Plugin v0.1.0 (https://github.com/artscorestudio/jquery-asfPreload)
 * Copyright 2012-2014 Artscore Studio (http://www.artscore-studio.fr)
 * Licensed under MIT License (https://github.com/artscorestudio/jquery-asfPreload/blob/master/LICENSE)
 */

if("undefined"==typeof jQuery)throw new Error("AsfPreload requires jQuery");!function(a,b,c,d){function e(b,c){i=this,i.$element=a(b),i.options=a.extend({},g,c),i._defaults=g,i._name=f,i._availablePBarStyles=h,i._eventName=j,i.init(i)}var f="asfPreload",g={percent:0,imgFolder:"Resources/artscorestudio/jquery-preload/img/",preloadEmptyImg:"preload-empty.png",preloadFullImg:"preload-full.png",speed:200,PIStep:.1,limit:100,loop:!1,showPercent:!0,progressBarStyle:"circle",backgroundColor:"rgba(23,23,23,1)",onProgress:function(){},onComplete:function(){}},h=["horizontalBar","circle"],i=null,j="asfPBar-";e.prototype={init:function(){i.$element.css({width:a(b).width(),height:a(b).height(),background:i.options.background}),i.createElements(),this.setEvents(),i.$progressBar.animate({opacity:1},500,function(){}),i.ctx=i.$ctx[0].getContext("2d"),i.ctx.fillStyle=i.options.backgroundColor,i.options.percent=i.options.percent%100,i.i=2*i.options.percent*Math.PI/100,i.j=0,i.stop=0,i.draw(),i.onResize()},onResize:function(){a(b).resize(function(){a(b).width(),a(b).height();i.$element.css({width:a(b).width(),height:a(b).height()}),i.$progressBar.css({marginLeft:(i.$element.width()-i.width)/2+i.marginLeft,marginTop:(i.$element.height()-i.height)/2+i.marginTop,opacity:1})})},setEvents:function(){i.$element.bind(i._eventName+"onInit"),i.$element.bind(i._eventName+"onProgress",i.options.onProgress),i.$element.bind(i._eventName+"onComplete",i.options.onComplete),i.$element.bind(i._eventName+"start",function(){i.command.start()}),i.$element.bind(i._eventName+"stop",function(){i.command.stop()}),i.$element.bind(i._eventName+"reset",function(){i.command.reset()}),i.$element.bind(i._eventName+"destroy",function(){i.command.destroy()}),i.$element.bind(i._eventName+"options",function(a,b){i.command.options(b)})},createElements:function(){i.$progressBar=a("<div />").addClass("asfPreload");var b=i.checkPBarStyle();if(""==i.options.progressBarStyle||i.options.progressBarStyle==d||0==b)throw'The style of progress bar is unavailable ("horizontalBar" or "circle" are available)';i.$progressBar.addClass(i.options.progressBarStyle),i.preloadEmptyImg=new Image,i.preloadEmptyImg.src=i.options.imgFolder+i.options.preloadEmptyImg,i.preloadFullImg=new Image,i.preloadFullImg.src=i.options.imgFolder+i.options.preloadFullImg,i.width=i.preloadEmptyImg.width,i.height=i.preloadEmptyImg.height,i.marginTop=parseInt(i.$progressBar.css("marginTop").replace("ems","")),i.marginLeft=parseInt(i.$progressBar.css("marginLeft").replace("ems","")),i.$progressBar.css({marginLeft:(i.$element.width()-i.width)/2+i.marginLeft,marginTop:(i.$element.height()-i.height)/2+i.marginTop,opacity:0}),i.$percent=a("<div />").addClass("percent"),i.$percent,i.$ctx=a("<canvas />"),i.$ctx.attr("width",i.width),i.$ctx.attr("height",i.height),i.$element.prepend(i.$progressBar),i.$progressBar.append(i.$percent),i.$progressBar.append(i.$ctx)},draw:function(){i&&(i.$element.trigger(i._eventName+"onInit",[i.options.percent]),(0==i.width||0==i.height)&&i.reloadImages(),0==i.options.showPercent?i.$percent.hide():i.$percent.show(),1!=i.stop&&i.options.percent-1<=i.options.limit&&(1==i.options.loop&&(i.options.limit=121),i.options.percent>=100&&i.options.percent<=i.options.limit&&(i.i=0,i.options.limit=i.options.limit-100),i.coreDraw(),i.i=i.i+i.options.PIStep,i.options.percent=100*i.i/(2*Math.PI),i.options.percent<=i.options.limit?(setTimeout(i.draw,i.options.speed),i.$percent.html(i.options.percent.toFixed(0)),i.$element.trigger(i._eventName+"onProgress",[i.options.percent.toFixed(0)])):(i.$percent.html(i.options.limit),i.coreDraw(),i.$element.trigger(i._eventName+"onProgress",[i.options.limit]),100==i.options.limit&&i.$element.trigger(i._eventName+"onComplete")),i.options.percent++))},coreDraw:function(){i.ctx.clearRect(0,0,i.width,i.height),i.ctx.save(),i.ctx.drawImage(i.preloadEmptyImg,0,0),i.ctx.beginPath(),i.ctx.lineWidth=5,i.ctx.arc(i.width/2,i.height/2,i.height/2,i.i-Math.PI/2,i.j-Math.PI/2,!0),i.ctx.lineTo(i.width/2,i.height/2),i.ctx.closePath(),i.ctx.fill(),i.ctx.clip(),i.ctx.drawImage(i.preloadFullImg,0,0),i.ctx.restore()},destroy:function(){i.$progressBar.animate({opacity:0},500,function(){i.$progressBar.remove(),i.stop=1})},checkPBarStyle:function(){var b=i,c=!1;return a.each(i._availablePBarStyles,function(a,d){String(d)==String(b.options.progressBarStyle)&&(c=!0)}),c},reloadImages:function(){i.preloadEmptyImg=new Image,i.preloadEmptyImg.src=i.options.imgFolder+i.options.preloadEmptyImg,i.preloadFullImg=new Image,i.preloadFullImg.src=i.options.imgFolder+i.options.preloadFullImg,i.width=i.preloadEmptyImg.width,i.height=i.preloadEmptyImg.height,i.$progressBar.css({marginLeft:(a(i.element).width()-i.width)/2+i.marginLeft,marginTop:(a(i.element).height()-i.height)/2+i.marginTop}),i.$ctx.attr("width",i.width),i.$ctx.atrr("height",i.height),i.ctx=i.$ctx[0].getContext("2d"),i.ctx.fillStyle=i.options.backgroundColor},command:{start:function(){i.stop=0,i.draw()},stop:function(){i.stop=1},reset:function(){i.options.percent=0,i.i=0,i.draw()},destroy:function(){i.destroy()},options:function(b){return i.options=a.extend({},i.options,b),(b.preloadEmptyImg||b.preloadFullImg)&&(i.reloadImages(),i.coreDraw()),i.draw(),i.options}}},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})},a.fn[f].getStartEventName=function(){return j+"start"},a.fn[f].getStopEventName=function(){return j+"stop"},a.fn[f].getResetEventName=function(){return j+"reset"},a.fn[f].getDestroyEventName=function(){return j+"destroy"},a.fn[f].getOptionsEventName=function(){return j+"options"}}(jQuery,window,document);